doctype html
html(itemscope, itemtype='http://schema.org/Product')
	head
		title Track changes and commenting in LaTeX
		link(rel="icon", href="/favicon.ico")
		if buildCssPath
			link(rel='stylesheet', href=buildCssPath('/style.css'))
		link(href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css",rel="stylesheet")
	body
		main.rfp-main
			section.rfp-section.rfp-section-masthead#intro
				h1.rfp-h1.rfp-h1-masthead
					span.rfp-h1-masthead-portion.rfp-highlight Track changes&nbsp;
					span.rfp-h1-masthead-portion and&nbsp;
					span.rfp-h1-masthead-portion.rfp-highlight comments&nbsp;
					span.rfp-h1-masthead-portion in&nbsp;
					span.rfp-h1-masthead-portion.rfp-highlight LaTeX
				video.rfp-video.rfp-video-masthead(
					autoplay
					loop
				)
					source(src="/img/feature-page/intro.mp4", type="video/mp4")
				p.rfp-lead We remember the old days where you had to choose between using Track Changes in Word, or typesetting with LaTeX.
				p.rfp-lead.rfp-lead-strong Now you can do both.
			section.rfp-section.rfp-section-blockquote
				blockquote.rfp-quote-main 
					p.rfp-quoted-text I can't tell you what a game-changer this new feature is for me and my collaborators. This feature puts ShareLatex miles above the competition, as no one else has anything close to it.
					figure.rfp-quoted-person
						img.rfp-quoted-person-photo(src="https://randomuser.me/api/portraits/women/43.jpg")
						figcaption
							p.rfp-quoted-person-name July 
							a.rfp-quoted-person-link(href="www.google.com") Some Great University
			section.rfp-section.rfp-section-feature 
				.rfp-feature-description-container
					h2.rfp-h2 
						span.rfp-highlight Discuss 
						| Within ShareLaTeX
					p.rfp-p With real-time commenting, you can discuss your work without having to switch to email, printed versions or any other tool.
					p.rfp-p Leave comments, give quick feedback and resolve issues much more effectively with everything happening inside a single tool.
				.rfp-feature-video-container
					video.rfp-video.rfp-video-anim#video-1(
						loop
					)
						source(src="/img/feature-page/feat-discuss.mp4", type="video/mp4")
			section.rfp-section.rfp-section-feature.rfp-section-feature-alt
				.rfp-feature-description-container
					h2.rfp-h2 
						| Track All 
						span.rfp-highlight Changes
					p.rfp-p Keep track of every change made to the document, along with the person making the change.
					p.rfp-p ShareLaTeX is the only LaTeX editor with real time tracked changes. Now there's nothing holding you back from being able to collaborate using LaTeX.
				.rfp-feature-video-container
					video.rfp-video.rfp-video-anim.rfp-video-anim-alt#video-2(
						loop
					)
						source(src="/img/feature-page/feat-changes.mp4", type="video/mp4")
			section.rfp-section.rfp-section-feature
				.rfp-feature-description-container
					h2.rfp-h2 
						| Keep One 
						span.rfp-highlight To-do 
						| List
					p.rfp-p Keep an up-to-date list of all of the things you need to work through, without having to sift through out-of-date notes or dig out old emails.
					p.rfp-p Comments alongside your work are a great way to keep a todo list, reminding you of everything that still needs to be done.
				.rfp-feature-video-container
					video.rfp-video.rfp-video-anim#video-3(
						loop
					)
						source(src="/img/feature-page/feat-todos.mp4", type="video/mp4")
			section.rfp-section.rfp-section-feature.rfp-section-feature-alt
				.rfp-feature-description-container
					h2.rfp-h2 
						span.rfp-highlight Accept 
						| and 
						span.rfp-highlight Reject 
						| Changes
					p.rfp-p Easily find what your co-authors or reviewers have changed see how it impacts the document.
					p.rfp-p Accept or reject individual changes quickly with the click of a button, and move onto the next change needing your attention.
				.rfp-feature-video-container
					video.rfp-video.rfp-video-anim.rfp-video-anim-alt#video-4(
						loop
					)
						source(src="/img/feature-page/feat-accept.mp4", type="video/mp4")
			section.rfp-section.rfp-section-testimonials
				h2.rfp-h2 ShareLaTeX has revolutionized LaTeX collaboration. Again.
				p.rfp-lead We kept hearing how frustrating it could be to figure out what changes had been made by other collaborators.
				p.rfp-lead So we put our coding hats on and did something about it.
				p.rfp-lead Here's what some of our users said when we showed them the new comments and track changes features.
				.rfp-quote-section
					blockquote.rfp-quote 
						p.rfp-quoted-text I can't tell you what a game-changer this new feature is for me and my collaborators. This feature puts ShareLatex miles above the competition, as no one else has anything close to it.
						figure.rfp-quoted-person
							img.rfp-quoted-person-photo(src="https://randomuser.me/api/portraits/women/75.jpg")
							figcaption
								p.rfp-quoted-person-name Christina Gold
								a.rfp-quoted-person-link @chrisgoldie 
					blockquote.rfp-quote 
						p.rfp-quoted-text I was so thrilled when I came into the office this morning that I burst into my postdocs' office, urging them to drop everything right now and log onto ShareLatex and look at the paper we are currently working on in there!
						figure.rfp-quoted-person
							img.rfp-quoted-person-photo(src="https://randomuser.me/api/portraits/men/31.jpg")
							figcaption
								p.rfp-quoted-person-name Vlad Mann
								a.rfp-quoted-person-link @vladtheman
			section.rfp-section.rfp-section-final
				h2.rfp-h2 ShareLaTeX has more than 1 million users around the world, including:
				div.rfp-users
					figure.rfp-user-container
						img.rfp-user-logo(src="/img/feature-page/user-nasa-jpl.png")
					figure.rfp-user-container
						img.rfp-user-logo(src="/img/feature-page/user-caltech.png")
					figure.rfp-user-container
						img.rfp-user-logo(src="/img/feature-page/user-deepmind.png")
					figure.rfp-user-container
						img.rfp-user-logo(src="/img/feature-page/user-chalmers.png")
				.rfp-cta-container
					h3.rfp-h3.rfp-h3-cta Start using ShareLaTeX today to see these features in action.
					p.rfp-lead.rfp-lead-cta Join more than a million other people using ShareLaTeX.
					a.rfp-cta(href="#") 
						span.rfp-cta-main Start using ShareLaTeX
						span.rfp-cta-extra Get 7 days free
		script(type="text/javascript").
			(function(){
				// Underscore utils.
				var restArgs = function(func, startIndex) {
					startIndex = startIndex == null ? func.length - 1 : +startIndex;
					return function() {
						var length = Math.max(arguments.length - startIndex, 0),
								rest = Array(length),
								index = 0;
						for (; index < length; index++) {
							rest[index] = arguments[index + startIndex];
						}
						switch (startIndex) {
							case 0: return func.call(this, rest);
							case 1: return func.call(this, arguments[0], rest);
							case 2: return func.call(this, arguments[0], arguments[1], rest);
						}
						var args = Array(startIndex + 1);
						for (index = 0; index < startIndex; index++) {
							args[index] = arguments[index];
						}
						args[startIndex] = rest;
						return func.apply(this, args);
					};
				};
				var _ = {};
				_.now = Date.now || function() {
					return new Date().getTime();
				};
				_.delay = restArgs(function(func, wait, args) {
					return setTimeout(function() {
						return func.apply(null, args);
					}, wait);
				});
				var throttle = function(func, wait, options) {
					var timeout, context, args, result;
					var previous = 0;
					if (!options) options = {};

					var later = function() {
						previous = options.leading === false ? 0 : _.now();
						timeout = null;
						result = func.apply(context, args);
						if (!timeout) context = args = null;
					};

					var throttled = function() {
						var now = _.now();
						if (!previous && options.leading === false) previous = now;
						var remaining = wait - (now - previous);
						context = this;
						args = arguments;
						if (remaining <= 0 || remaining > wait) {
							if (timeout) {
								clearTimeout(timeout);
								timeout = null;
							}
							previous = now;
							result = func.apply(context, args);
							if (!timeout) context = args = null;
						} else if (!timeout && options.trailing !== false) {
							timeout = setTimeout(later, remaining);
						}
						return result;
					};

					throttled.cancel = function() {
						clearTimeout(timeout);
						previous = 0;
						timeout = context = args = null;
					};

					return throttled;
				};

				var debounce = function(func, wait, immediate) {
					var timeout, result;

					var later = function(context, args) {
						timeout = null;
						if (args) result = func.apply(context, args);
					};

					var debounced = restArgs(function(args) {
						if (timeout) clearTimeout(timeout);
						if (immediate) {
							var callNow = !timeout;
							timeout = setTimeout(later, wait);
							if (callNow) result = func.apply(this, args);
						} else {
							timeout = _.delay(later, wait, this, args);
						}

						return result;
					});

					debounced.cancel = function() {
						clearTimeout(timeout);
						timeout = null;
					};

					return debounced;
				};

				var initialized = false;
				var elements = [
					{ id: 'intro',   visibleClass: 'rfp-section-masthead-in', node: undefined, position: undefined, viewed: false },
					{ id: 'video-1', visibleClass: 'rfp-video-anim-in', node: undefined, position: undefined, viewed: false },
					{ id: 'video-2', visibleClass: 'rfp-video-anim-in', node: undefined, position: undefined, viewed: false },
					{ id: 'video-3', visibleClass: 'rfp-video-anim-in', node: undefined, position: undefined, viewed: false },
					{ id: 'video-4', visibleClass: 'rfp-video-anim-in', node: undefined, position: undefined, viewed: false },
				];

				function getCoords (node) { // crossbrowser version
					var box = node.getBoundingClientRect();

					var body = document.body;
					var docEl = document.documentElement;

					var scrollTop = window.pageYOffset || docEl.scrollTop || body.scrollTop;
					var scrollLeft = window.pageXOffset || docEl.scrollLeft || body.scrollLeft;

					var clientTop = docEl.clientTop || body.clientTop || 0;
					var clientLeft = docEl.clientLeft || body.clientLeft || 0;

					var top  = box.top +  scrollTop - clientTop;
					var left = box.left + scrollLeft - clientLeft;

					return { top: Math.round(top), left: Math.round(left) };
				}

				function refreshEls (shouldInitialize) {
					if (shouldInitialize) {
						initialized = true;
					}
					// do the coord refresh
					if (initialized) {
						for (var i = 0; i < elements.length; i++) {
							var curEl = elements[i];
							if (!curEl.node) {
								curEl.node = document.getElementById(curEl.id);
							}
							if (!curEl.viewed) {
								curEl.position = getCoords(curEl.node).top + (curEl.node.offsetHeight * 0.35);
							}
						}
						handleScroll();
					}
				}

				function handleScroll () {
					var windowPos = window.pageYOffset + window.innerHeight;

					for (var i = 0; i < elements.length; i++) {
						var curEl = elements[i];
						if (windowPos > curEl.position && !curEl.viewed) {
							curEl.viewed = true;
							curEl.node.classList.add(curEl.visibleClass);
							if (curEl.node.tagName.toLowerCase() === 'video') {
								curEl.node.play();
							}
						}
					}
				}

				// TODO debounce and throttle.
				window.addEventListener('resize', debounce(refreshEls, 50, true));
				window.addEventListener('orientationchange', debounce(refreshEls, 50, true));
				window.addEventListener('scroll', throttle(handleScroll, 100));

				document.addEventListener('DOMContentLoaded', function () {
					refreshEls(true);
				});
			}());